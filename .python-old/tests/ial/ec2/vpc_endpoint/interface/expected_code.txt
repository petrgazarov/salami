ec2.VpcEndpoint(
    "EcrDkrVpcEndpoint",
    vpc_id=cumuli_vpc.id,
    vpc_endpoint_type="Interface",
    service_name=f"com.amazonaws.{aws_region}.ecr.dkr",
    private_dns_enabled=True,
    subnet_ids=[private_subnet_a.id, private_subnet_b.id],
    security_group_ids=[ecr_vpc_endpoint_s_g.id],
    policy=policy=pulumi.Output.all(cumuli_ecs_execution_role.arn, python_exec_ecs_execution_role.arn).apply(lambda args: json.dumps(
        {
            "Version": "2012-10-17",
            "Statement": [
                {
                    "Effect": "Allow",
                    "Principal": {
                        "AWS": [
                            args[0],
                            args[1],
                        ]
                    },
                    "Action": [
                        "ecr:BatchCheckLayerAvailability",
                        "ecr:GetDownloadUrlForLayer",
                        "ecr:BatchGetImage",
                    ],
                    "Resource": [
                        f"arn:aws:ecr:{aws_region}:{aws_account_id}:repository/*"
                    ],
                },
            ],
        }
    )),
)